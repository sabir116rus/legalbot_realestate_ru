
# LegalBot ‚Äî –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π Telegram‚Äë–±–æ—Ç (–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, RU)

–ü—Ä–æ–µ–∫—Ç: —á–∞—Ç-–±–æ—Ç –≤ Telegram c –Ω–µ–π—Ä–æ–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º OpenAI –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ —Ç–µ–º–µ **–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏**. 
–ü–æ–¥—Ö–æ–¥: **Python (aiogram 3) + –ø—Ä–æ—Å—Ç–∞—è RAG –ø–æ CSV**.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1) –°–æ–∑–¥–∞–π –±–æ—Ç–∞ —É @BotFather –∏ –ø–æ–ª—É—á–∏ **TELEGRAM_BOT_TOKEN**.  
2) –ü–æ–ª—É—á–∏ –∫–ª—é—á OpenAI –∏ —É–∫–∞–∂–∏ **OPENAI_API_KEY**.  
3) –°–∫–æ–ø–∏—Ä—É–π `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è.  
4) –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—é—Ç `aiogram`, `aiohttp`, `rapidfuzz`, `tiktoken`, –∞ —Ç–∞–∫–∂–µ `pytest` –∏ `pytest-asyncio` –¥–ª—è —Ç–µ—Å—Ç–æ–≤):
   ```bash
   pip install -r requirements.txt
   ```
5) –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:  
   ```bash
   python bot.py
   ```

–ö–æ–º–∞–Ω–¥—ã:
- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∑–∞–ø—É—Å–∫
- `/help` ‚Äî –ø–æ–º–æ—â—å –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É –≤–æ–ø—Ä–æ—Å–æ–≤
- `/consultation` ‚Äî —Å–±–æ—Ä –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
- `/new_ask` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏, —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ–π–¥—ë—Ç –±–µ–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ (–¥–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–æ—Ç–∞). –í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–æ–∂–Ω–æ –æ–±–Ω—É–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ–º–∞–Ω–¥–æ–π `/new_ask` –∏–ª–∏ –Ω–∞–∂–∞—Ç–∏–µ–º –∫–Ω–æ–ø–∫–∏ ¬´üîÑ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç¬ª –ø–æ–¥ –æ—Ç–≤–µ—Ç–æ–º –±–æ—Ç–∞ ‚Äî –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥.

–í–æ–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ: –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å —Ç–µ–∫—Å—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–∏—Ç—É–∞—Ü–∏–∏, –∏ –±–æ—Ç –ø–æ–¥–±–µ—Ä—ë—Ç –æ—Ç–≤–µ—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
   ‚Üì
Aiogram (–±–æ—Ç)
   ‚Üì
OpenAI (GPT)  ‚Üê  RAG (CSV: data/knowledge.csv)
   ‚Üì
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
legalbot_realestate_ru/
‚îú‚îÄ bot.py                    # –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –±–æ—Ç–∞
‚îú‚îÄ config.py                 # –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ø—É—Ç–µ–π –∫ —Ä–µ—Å—É—Ä—Å–∞–º
‚îú‚îÄ rag.py                    # –∑–∞–≥—Ä—É–∑–∫–∞ CSV –∏ –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π/–æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ analyze_logs.py           # —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ª–æ–≥–æ–≤
‚îú‚îÄ evaluate_csv_coverage.py  # –æ—Ç—á—ë—Ç –ø–æ –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã–º –≤–æ–ø—Ä–æ—Å–∞–º
‚îú‚îÄ prompt_system_ru.txt      # —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
‚îú‚îÄ requirements.txt
‚îú‚îÄ .env.example
‚îú‚îÄ services/
‚îÇ  ‚îú‚îÄ answer_service.py              # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ OpenAI –∏ RAG
‚îÇ  ‚îú‚îÄ interaction_logger.py          # –∑–∞–ø–∏—Å—å –≤–æ–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –≤ CSV —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–æ–º
‚îÇ  ‚îú‚îÄ consultation_logger.py         # —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º CSV
‚îÇ  ‚îî‚îÄ webapp/
‚îÇ     ‚îú‚îÄ privacy_policy.html         # —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
‚îÇ     ‚îî‚îÄ privacy_policy_webapp.py    # –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ aiohttp –¥–ª—è –≤—ã–¥–∞—á–∏ HTML
‚îú‚îÄ data/
‚îÇ  ‚îú‚îÄ knowledge.csv                  # –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (CSV)
‚îÇ  ‚îú‚îÄ log.csv                        # –ª–æ–≥ –≤–æ–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ  ‚îî‚îÄ consultations.csv              # –∑–∞—è–≤–∫–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ tests/                            # –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã pytest –∏ pytest-asyncio
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- `Config.load` –∏–∑ `config.py` —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø—É—Ç–∏ –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π, —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—É –∏ CSV‚Äë–ª–æ–≥—É.
- `AnswerService` (—Å–º. `services/answer_service.py`) –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã RAG —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `AsyncOpenAI` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –í –æ—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ‚Äë–ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å `error`.
- `InteractionLogger` (—Å–º. `services/interaction_logger.py`) —Å–æ–∑–¥–∞—ë—Ç CSV‚Äë–ª–æ–≥, –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, top_score –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (—á–µ—Ä–µ–∑ `tiktoken`).
- `ConsultationLogger` (—Å–º. `services/consultation_logger.py`) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞—è–≤–∫–∏ –Ω–∞ –∂–∏–≤—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –≤ —Ñ–∞–π–ª `data/consultations.csv`.
- `ConsentStore` (—Å–º. `services/consent_store.py`) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ `data/consents.json`. –°–æ–≥–ª–∞—Å–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π, –≤–∫–ª—é—á–∞—è –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ –∫–æ–º–∞–Ω–¥.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞

`AnswerService.generate_answer` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AnswerResult`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `text` ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ Markdown‚Äë—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è;
- `top_score` ‚Äî –æ—Ü–µ–Ω–∫—É —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ª—É—á—à–µ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π;
- `status` ‚Äî `ok` –∏–ª–∏ `error`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞–∑—ã —Å–µ—Ç–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ CSV‚Äë–ª–æ–≥–∞—Ö.

–í `bot.py` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –æ `/new_ask`, –∞ —Ç–∞–∫–∂–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –¥–∏—Å–∫–ª–µ–π–º–µ—Ä –æ —Ç–æ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä.

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã

–ë–æ—Ç —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏ (–¥–æ `HISTORY_LIMIT = 10`) –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –µ—ë –≤–º–µ—Å—Ç–µ —Å –Ω–æ–≤—ã–º –≤–æ–ø—Ä–æ—Å–æ–º, —á—Ç–æ —É–ª—É—á—à–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏–∞–ª–æ–≥–∞. –ö–æ–º–∞–Ω–¥–∞ `/new_ask` –∏ –∫–Ω–æ–ø–∫–∞ —Å callback `new_ask_reset` –æ—á–∏—â–∞—é—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—ç—Ç–æ–º—É —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤.

## –ó–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

–ö–æ–º–∞–Ω–¥–∞ `/consultation` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –¥–∏–∞–ª–æ–≥:
1. –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2. –ó–∞—Ç–µ–º –ø—Ä–æ—Å–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã (—Ç–µ–ª–µ—Ñ–æ–Ω, email, –Ω–∏–∫ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ).
3. –ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å.

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ `data/consultations.csv`. –¢–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–æ–ª–±—Ü—ã `timestamp`, `user_id`, `username`, `full_name`, `contact`, `request`. –§–∞–π–ª –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤ Excel/Google Sheets, –ø–µ—Ä–µ–¥–∞—Ç—å —é—Ä–∏—Å—Ç—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

## –£—Ç–∏–ª–∏—Ç—ã

- `analyze_logs.py` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ CSV –ª–æ–≥–∞–º, —Å—Ç—Ä–æ–∏—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ç–µ–º–∞–º, –º–æ–¥–µ–ª—è–º –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º. –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:
  ```bash
  python analyze_logs.py --log data/log.csv
  ```

## –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏

–ï—Å–ª–∏ Telegram —Ç—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, –ø–æ–¥–Ω–∏–º–∏ –º–∏–Ω–∏-–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ –ø–∞–∫–µ—Ç–∞ `services.webapp`.
–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ –∏ –ø–æ—Ä—Ç—É –∏ –æ—Ç–¥–∞—ë—Ç –≥–æ—Ç–æ–≤—ã–π HTML:

```bash
python -m services.webapp.privacy_policy_webapp --host 0.0.0.0 --port 8080
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `PRIVACY_POLICY_WEBAPP_URL`, —á—Ç–æ–±—ã –±–æ—Ç —Ä–∞–∑–¥–∞–≤–∞–ª —ç—Ç—É —Å—Å—ã–ª–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
export PRIVACY_POLICY_WEBAPP_URL="http://localhost:8080/privacy-policy"
```

–ó–∞–º–µ–Ω–∏—Ç–µ `localhost` –∏ –ø–æ—Ä—Ç –Ω–∞ –∞–¥—Ä–µ—Å, –¥–æ—Å—Ç—É–ø–Ω—ã–π –≤–∞—à–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ reverse-proxy).

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Drive

–î–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤ –≤ Google Drive –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏ –≤–Ω–µ—à–Ω—é—é –∑–∞–¥–∞—á—É/—Å–∫—Ä–∏–ø—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, cron –∏–ª–∏ CI), –∫–æ—Ç–æ—Ä—ã–π —Å—á–∏—Ç—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Ö –≤ –æ–±–ª–∞–∫–æ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Google Cloud Console](https://console.cloud.google.com/), –≤–∫–ª—é—á–∏—Ç–µ API ¬´Google Drive¬ª –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.
2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ. –î–æ–±–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –Ω—É–∂–Ω–æ–π –ø–∞–ø–∫–∏ Google Drive.
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ `.env`), —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞–º –≤—ã–≥—Ä—É–∑–∫–∏:
   - `GOOGLE_DRIVE_SERVICE_ACCOUNT_JSON` ‚Äî –ø—É—Ç—å –¥–æ JSON‚Äë–∫–ª—é—á–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞;
   - `GOOGLE_DRIVE_FOLDER_ID` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞–ø–∫–∏, –∫—É–¥–∞ –±—É–¥—É—Ç –≤—ã–≥—Ä—É–∂–∞—Ç—å—Å—è —Ñ–∞–π–ª—ã;
   - `GOOGLE_DRIVE_REPORTS_SUBFOLDER` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤.
4. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Å—Ä–µ–¥–µ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Google API. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤

- –§–∞–π–ª `data/log.csv` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `InteractionLogger`. –í–Ω–µ—à–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª –≤ Google Drive, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É CSV.
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã (`analyze_logs.py`, `evaluate_csv_coverage.py`) —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ CSV/—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã. –ò—Ö —Å—Ç–æ–∏—Ç —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ `GOOGLE_DRIVE_REPORTS_SUBFOLDER`, –µ—Å–ª–∏ –æ–Ω –∑–∞–¥–∞–Ω.
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ Google Drive –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ: –ª–æ–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `data/`, –∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –∏–ª–∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.

## –û—Ü–µ–Ω–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

–°–∫—Ä–∏–ø—Ç `evaluate_csv_coverage.py` –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –ª–æ–≥–∞—Ö –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

```bash
python evaluate_csv_coverage.py --threshold 60
```

- `--threshold` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `top_score`, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –≤–æ–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–∫—Ä—ã—Ç—ã–º.
- `--recompute-score` ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ü–µ–Ω–∫–∏ —á–µ—Ä–µ–∑ `KnowledgeBase` –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö `top_score`.
- `--top-n` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–∞–º—ã—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞–∑–∞—Ç—å –≤ –æ—Ç—á—ë—Ç–µ.
- `--out report.csv` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –ø—Ä–æ–±–ª–µ–º–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –≤ —Ñ–∞–π–ª.
- –û–±–µ CLI-—É—Ç–∏–ª–∏—Ç—ã –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –∫–æ–¥–æ–º `1`, –µ—Å–ª–∏ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è: `analyze_logs.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ª–æ–≥–∞, –∞ `evaluate_csv_coverage.py` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø—É—Ç—å –∫ CSV –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

## CSV ‚Äî —Ñ–æ—Ä–º–∞—Ç –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

| id | topic | question | answer | law_refs | url |
|----|-------|----------|--------|----------|-----|

- **law_refs** ‚Äî –∫—Ä–∞—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∞—Ç—å–∏/–Ω–æ—Ä–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ì–ö –†–§ —Å—Ç. 209; 454‚Äì491; 558").
- **url** ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫ (–ì–æ—Å—É—Å–ª—É–≥–∏, Consultant, –ì–∞—Ä–∞–Ω—Ç –∏ —Ç. –ø.).

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –¥–∏—Å–∫–ª–µ–π–º–µ—Ä

–ë–æ—Ç –¥–∞—ë—Ç **–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ‚Äë—Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ** –æ—Ç–≤–µ—Ç—ã –ø–æ –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∏ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –ù–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–≤–æ–∫–∞—Ç–æ–º.
–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ—á–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —é—Ä–∏—Å—Ç–∞.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ì–æ—Ç–æ–≤—ã–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –ª–µ–∂–∞—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `tests/` –∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ä–∞–±–æ—Ç—É RAG, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤ –∏ –ª–æ–≥–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ `requirements.txt` (–≤–∫–ª—é—á–∞—è `pytest` –∏ `pytest-asyncio`) –∑–∞–ø—É—Å—Ç–∏ –≤–µ—Å—å –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥–æ–π:

```bash
pytest
```
